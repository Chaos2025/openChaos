# `openChaos` 操作系统
“杀鸡焉用宰牛刀” —— 《论语·阳货》

# 项目背景

参加了清华大学和泉城实验室组织的《2024秋冬季OS训练营》后，使我对操作系统有了一个全新的认识。该训练营介绍了基于 `libos` 框架的操作系统 `arceos` ，以及以此为基础的一系列的扩展。参加完训练营之后，让我对操作系统的认识有一个突破性的认识。

每个操作系统都有自己的特点（ ***仅代表个人观点*** ）：

+ `windows` 操作系统，使用基于优先级的调度方式，并且将系统进程和用户进行分别运行在高16和低16个优先级，使得在调整进程运行顺序时可以很方便的进行优化；
+ `macos` 操作系统，也采用基于优先级的调度方式，并且兼容 `posix` 标准的程序；它会将系统的资源更多的分配给用户的前台进程，以保证用户的体验；
+ `Android` 操作系统，虽然采用 `Linux` 内核，但使用了 `Linux` 的 `cgroup` 机制来实现 `macos` 类似的机制，将更多的资源分配给前台进程；
+ `Linux` 操作系统采用了 `CFS` 的调度机制，从根本上解决了进程的 ”饥饿“ 问题，使得各个进程都能得到很好的运行；
+ `Arceos` 操作系统，虽然只是一个用 Rust 编写的实验性模块化操作系统，但其实现了函数调用来替代系统调用的思路，从而减少了系统的开销；

由于每个操作系统都有各自的特性，也就有各自的应用场景。

随着 `AI` 的应用越来越广泛，一个 `AI` 爆发的时代已经到来。当前每个项目都或多或少的要跟 `AI` 有关。而且随着芯片的算力越来越强，`AI` 不再只是运行在算力强大的 `PC` 机/服务器上，工程师们也在进行 `AI` 在端/边侧运行的尝试，例如：在智能摄像头上增加物体识别的能力。随着智能设备的发展，会有越来越多的设备会集成 `AI` 来增加产品的功能。但是这些智能产品的功能相对单一并固定，他们不会象 `PC` 机一样具有多用用途。对这样的应用来说嵌入式的 `freertos` 操作系统显得有些单薄，而功能强大的 `Linux` 等操作系统又显得过于复杂。这时就需要一款能够在单一场景中提供相对复杂功能，占用资源较少的一款操作系统——这就是项目创立的初衷。

# 项目介绍
该项目借鉴清华大学的开源操作系统 `Arceos` 的部分思路和部分代码：内核部分前期使用 `Arceos` 的子集，后期会对内核代码进行重构。
该操作系统主要针对单一应用的场景，尤其是 `AI` 在端侧应用的智能设备上的应用场景。

## 项目应用场景
单一应用，且功能相对复杂的场景。

## 项目版块

本项目分为 3 个板块：

+ 系统版块
+ 编译器版块
+ 调试及仿真版块

### 1. 系统版块

系统板块就是系统的设计和实现部分，是本项目的主题部分。

#### 设计指标
+ 系统简单：
	+ 没有用户态和内核态之分 ；
	+ 使用函数调用替代系统调用；
	+ 不支持多进程；
	+ 不支持动态库；
+ 兼容 `posix` 应用；
+ 应用和系统分离：
	+ 通过应用加载器加载用户应用；
	+ 用户在 `Linux` 下开发和调试，然后通过专有编译器编译后可以直接在本系统上运行；

### 2. 编译器版块

`musl libc` 是一款符合 `posix` 标准的适用于嵌入式产品的 `C` 库，且 `musl` 专为静态链接而设计，小心避免提取应用程序不会使用的大量代码或数据。因此在本项目中选用 `musl libc` 库作为系统默认的 `C` 库。

在标准的 `libc` 库中，当用户程序需要用到操作系统提供的功能时，就会通过系统调用进入内核态并通过系统调用号来执行相应的功能。在 `openChaos` 操作系统由于没有用户态和内核态的区分，所以可以采用函数调用来替代系统调用以减少操作系统的开销提高整体的性能。这时就需要对 `musl libc` 库进行改造来实现这一机制。

### 3. 调试及仿真版块

虽然本项目的目标是实现软件在 `Linux` 和 `openChaos` 上源代码级别的可移植性，但是 `openChaos` 致力于提高系统的实时性，所以在某些场景还需要进行一定的调试。调试系统除了在开发板上直接使用串口输出调试信息外，还可以考虑使用虚拟机和 `gdb` 联合的方式进行 —— 本项目考虑使用 `qemu + gdb` 的方式进行。

> 本仓库为系统版块的仓库： https://github.com/Chaos2025/openChaos
>
> 编译器版块仓库：https://github.com/Chaos2025/musl4openChaos
>
> 调试及仿真版块仓库：https://github.com/Chaos2025/qemu4openChaos

# 项目创始人
+ 安利军

  `2003` 年毕业于河北师大应用电子专业。曾从事嵌入式硬件和软件的开发，以及 `Linux` 内核的相关开发。
  在 `2009` 年时在 `MCS51` 单片机上自主设计了抢占式的双线程操作系统。